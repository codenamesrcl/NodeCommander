(function () {
    'use strict';

    angular.module('nodetools', [
        // Angular modules 

        // Custom modules 

        // 3rd Party Modules
        
    ]);

    
}());

(function(){
	'use strict'

	/**
	*
	* @ngdoc factory
	* @module  nodetools
	* @name  execFactory
	*
	* 
	* @description
	* Exposes exec child_processes to angular
	* Very powerful stuff 
	* Users should be familiar with a cli and/or Node's REPL before
	* using within angular
	*/

	angular 
		.module('nodetools')
		.factory('execFactory', factory);


	function factory(){
		var service = {
			newRunner: newRunner
		};


		function newRunner(command, config, eventHandler){
			//create a new command object and return it
			//back to the caller
			var runner = new ExecRunner(command, config, eventHandler);
			return runner;
		}


		return service;
	}


	var _ = require("lodash");


	function ExecRunner(command, config, eventHandler){
		this.command = command;
		this.commandConfig = config;
		this.eventHandler = eventHandler;
		this.stdout = [];
		this.instance = null;
		this.logLimit = 100;
		this.isRunning = false;
	}
	ExecRunner.prototype.run = function(){

		var __addStdOut = function (data){
			if(!this.eventHandler){
				this.stdout.push(data);
				this.stdout = _.takeRight(this.stdout, this.logLimit);
			}
		}.bind(this);

		if(this.instance != null){
			console.log('instance is not null');
			this.kill();
		}

		this.stdout = [];
		var exec = require('child_process').exec;

		console.log(this.commandConfig);
		this.instance = exec(this.command,
			this.commandConfig,
			function (error, stdout, stderr) {}.bind(this)
		);
		
		this.isRunning = true;

		this.instance.stdout.on('data', function (data) {
			__addStdOut(data);
			if(this.eventHandler){
				this.eventHandler("stdout.data", data);
			}
		}.bind(this));

		this.instance.on('close', function (code) {
			//this.stdout.push('child process exited with code ' + code);
			this.isRunning = false;
			if(this.eventHandler){
				this.eventHandler("close", code);
			}
		}.bind(this));

		this.instance.on('exit', function(code){
			//this.stdout.push("exited clientportal-watch with code " + code);
			this.isRunning = false;
			if(this.eventHandler){
				this.eventHandler("exit", code);
			}
			this.instance = null;
		}.bind(this));
	}
	ExecRunner.prototype.kill = function(){
		var execKiller = require("tree-kill");
		
		if(this.instance){
			execKiller(this.instance.pid, 'SIGKILL', function(err) {
			    // Do things 
			});
			//this.instance.kill('SIGTERM');
		}
	}
	ExecRunner.prototype.setCommand = function(command, run){
		this.command = command;
		if(run){ this.run(); }
		else{ if(this.instance){ this.kill(); } }
	}






}());

(function () {
    'use strict';

    /**
     *
     * @ngdoc factory
     * @module nodetools
     * @name nodetools.fs
     * 
     * 
     * @description
     * Exposes some basic filesystem operations
     * to angular
     */
    angular
        .module('nodetools')
        .factory('nodetools.fs', fs);

    //fs.$inject = ['$q'];

    function fs() {
        var builderScanner = require(process.cwd() + '/lib/utility/builderScanner');

        var service = {
       		getDirectoryContents: builderScanner.getDirectoryContents,
        };

        return service;

    }
})();

(function () {
    'use strict';

    /**
     *
     * @ngdoc factory
     * @module  nodetools
     * @name  nodetools.process
     * 
     * @requires  $q
     * 
     * @description
     * Exposes aspects of node's process module to angular
     */
    angular
        .module('nodetools')
        .factory('nodetools.process', Process);

    Process.$inject = ['$q'];

    function Process($q) {
        var service = {
       		getCwd: function(){ return process.cwd(); }
        };

        return service;

    }
})();

//# sourceMappingURL=nodetools.min.js.map